<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Physio - The Therapeutic Moves</title>
<meta name="theme-color" content="#0f7a7a" />
<style>
  :root{
    --brand:#0f7a7a;
    --brand-2:#0aa284;
    --ink:#0f172a;
    --muted:#64748b;
    --bg:#f7faf9;
    --card:#ffffff;
    --soft:#e6f1ef;
    --danger:#e11d48;
    --shadow:0 8px 24px rgba(2,24,33,.08);
    --radius:14px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg)}
  a{color:inherit;text-decoration:none}
  img{max-width:100%;display:block}
  button{font:inherit}
  /* Header */
  .header{
    position:sticky;top:0;z-index:50;background:#fff;
    box-shadow:0 2px 10px rgba(0,0,0,.04)
  }
  .nav{
    max-width:1120px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;
    padding:10px 16px;gap:12px
  }
  .brand{display:flex;align-items:center;gap:10px}
  .logo{
    width:40px;height:40px;border-radius:10px;background:var(--soft);
    display:grid;place-items:center;color:var(--brand);font-weight:700
  }
  .brand .title{line-height:1}
  .brand .name{font-weight:700}
  .brand .tag{font-size:12px;color:var(--muted)}
  .hamburger{
    width:44px;height:44px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;display:grid;place-items:center;cursor:pointer
  }
  .hamburger span,.hamburger span:before,.hamburger span:after{
    content:"";display:block;width:18px;height:2px;background:#0b1720;border-radius:1px;position:relative
  }
  .hamburger span:before{position:absolute;top:-6px}
  .hamburger span:after{position:absolute;top:6px}
  /* Drawer */
  .drawer{
    position:fixed;inset:0 0 0 auto;width:min(84vw,320px);background:#fff;box-shadow:-10px 0 30px rgba(0,0,0,.12);
    transform:translateX(100%);transition:transform .25s ease;z-index:60;display:flex;flex-direction:column
  }
  .drawer.open{transform:translateX(0)}
  .drawer-header{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #eef2f7}
  .drawer-body{padding:12px 8px 24px;overflow:auto;flex:1}
  .menu{list-style:none;margin:0;padding:0}
  .menu li a{
    display:block;padding:12px 14px;border-radius:10px;margin:4px 6px;color:#0b1720
  }
  .menu li a:hover{background:#f2f7f6}
  .menu .admin{margin-top:12px;border-top:1px dashed #e5e7eb;padding-top:8px}
  /* Sections */
  .wrap{max-width:1120px;margin:0 auto;padding:10px 16px}
  .section-title{
    font-weight:800;margin:18px 4px 10px
  }
  .muted{color:var(--muted)}
  /* Hero */
  .hero{
    border-radius:18px;overflow:hidden;background:linear-gradient(135deg,#eaf7f5,#f7fcfb);
    box-shadow:var(--shadow);position:relative
  }
  .hero-inner{display:grid}
  .slides{position:relative;height:260px;overflow:hidden;background:#dfeeed}
  .slide{
    position:absolute;inset:0;background-size:cover;background-position:center;opacity:0;transition:opacity .6s ease
  }
  .slide.active{opacity:1}
  .hero-content{
    padding:18px 16px 16px;background:#fff;border-top:1px solid #eef3f0
  }
  .hero h1{margin:0 0 6px;font-size:22px}
  .hero p{margin:0 0 12px;color:var(--muted)}
  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    padding:12px 16px;border-radius:12px;border:none;cursor:pointer;font-weight:600
  }
  .btn-primary{background:var(--brand);color:#fff;box-shadow:0 6px 16px rgba(15,122,122,.25)}
  .btn-outline{background:#fff;border:1px solid #dbe6e3;color:var(--ink)}
  .btn-whatsapp{background:#25d366;color:#083b24}
  .tel{margin-top:10px;font-weight:600}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .action-btn{border:1px solid #e6efec;border-radius:12px;padding:10px 12px;background:#fff;display:flex;align-items:center;gap:8px}
  .action-btn img{width:18px;height:18px;object-fit:contain}
  /* Doctors horizontal carousel */
  .h-scroll{
    display:flex;gap:12px;overflow-x:auto;scroll-snap-type:x mandatory;padding:6px 2px 2px
  }
  .card{
    background:var(--card);border-radius:16px;box-shadow:var(--shadow)
  }
  .doc-card{
    min-width:240px;scroll-snap-align:start;overflow:hidden
  }
  .doc-photo{
    height:140px;background:#eaf2f1;display:grid;place-items:center;color:var(--brand);font-weight:700;font-size:18px
  }
  .doc-body{padding:12px}
  .pill{background:var(--soft);color:var(--brand);padding:4px 8px;border-radius:999px;font-size:12px;margin-left:6px}
  .fee{font-weight:700;margin-left:auto}
  .doc-meta{display:flex;align-items:center;gap:8px;margin:6px 0 10px;color:var(--muted)}
  .doc-actions{display:flex;gap:8px}
  /* Services */
  .service-banner{aspect-ratio:3/2;background:#eaf7f4;border-radius:16px;display:grid;place-items:center;color:var(--brand);box-shadow:var(--shadow);margin-bottom:10px}
  .services-rail{
    display:grid;grid-template-columns:1fr 1fr;gap:12px
  }
  .service-card{position:relative;overflow:hidden}
  .service-img{height:120px;background:#e5f3f0;background-size:cover;background-position:center}
  .service-body{padding:12px}
  .service-list{max-height:0;overflow:hidden;transition:max-height .3s ease}
  .service-card.open .service-list{max-height:260px}
  .badge{font-size:12px;color:#fff;background:var(--brand-2);padding:2px 8px;border-radius:999px}
  .test-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #e6ecea;color:#0f1b26}
  /* Products */
  .product-card{overflow:hidden}
  .product-img{height:150px;background:#f2f8f7;background-size:cover;background-position:center}
  .product-body{padding:12px}
  .price{color:#0a7a60;font-weight:800}
  /* Floating quick actions (mobile) */
  .fab-stack{
    position:fixed;right:14px;bottom:16px;display:flex;flex-direction:column;gap:10px;z-index:40
  }
  .fab{
    width:46px;height:46px;border-radius:50%;display:grid;place-items:center;border:none;cursor:pointer;
    box-shadow:0 10px 22px rgba(0,0,0,.18)
  }
  .fab.whatsapp{background:#25d366;color:#063; }
  .fab.call{background:#0f7a7a;color:#fff}
  .fab.map{background:#ef4444;color:#fff}
  /* Admin modal */
  .modal{
    position:fixed;inset:0;background:rgba(15,23,42,.45);display:none;align-items:center;justify-content:center;z-index:70
  }
  .modal.open{display:flex}
  .dialog{
    width:min(92vw,420px);background:#fff;border-radius:16px;box-shadow:var(--shadow);padding:16px
  }
  .dialog h3{margin:0 0 10px}
  .input{width:100%;padding:10px 12px;border:1px solid #e6ecea;border-radius:10px;background:#fff}
  .row{display:flex;gap:10px}
  .admin-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .note{font-size:12px;color:var(--muted)}
  /* Desktop tweaks */
  @media(min-width:900px){
    .slides{height:360px}
    .hero h1{font-size:28px}
    .services-rail{grid-template-columns:repeat(2,1fr)}
    .wrap{padding:16px}
  }
</style>
</head>
<body>

<!-- Header -->
<header class="header">
  <nav class="nav">
    <div class="brand">
      <div id="logo" class="logo">LOGO</div>
      <div class="title">
        <div class="name">Physio - The Therapeutic Moves</div>
        <div class="tag">"We add life in your days."</div>
      </div>
    </div>
    <button id="openMenu" class="hamburger" aria-label="Open menu"><span></span></button>
  </nav>
</header>

<!-- Drawer Menu -->
<aside id="drawer" class="drawer" aria-hidden="true">
  <div class="drawer-header">
    <strong>Menu</strong>
    <button id="closeMenu" class="btn btn-outline" style="padding:6px 10px;border-radius:8px">Close</button>
  </div>
  <div class="drawer-body">
    <ul class="menu">
      <li><a href="#home">Home</a></li>
      <li><a href="#doctors">Doctors</a></li>
      <li><a href="#services">Services</a></li>
      <li><a href="#products">Products</a></li>
      <li class="admin"><a href="#" id="adminLoginLink">Admin Login</a></li>
    </ul>
  </div>
</aside>

<!-- MAIN -->
<main class="wrap" id="home">

  <!-- HERO -->
  <section class="hero" id="hero">
    <div class="hero-inner">
      <div class="slides" id="heroSlides">
        <!-- Slides are injected from Firebase. Fallback demo slides below -->
        <div class="slide active" style="background-image:linear-gradient(135deg,#bfe9db,#eafbf6)"></div>
        <div class="slide" style="background-image:linear-gradient(135deg,#cfe7ff,#eaf3ff)"></div>
        <div class="slide" style="background-image:linear-gradient(135deg,#ffe3ce,#fff3e7)"></div>
      </div>
      <div class="hero-content">
        <h1>Physio - The Therapeutic Moves</h1>
        <p class="muted">"We add life in your days."</p>
        <div class="actions">
          <a class="btn btn-primary" id="bookWhatsApp">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 10.5v7a2.5 2.5 0 0 1-2.5 2.5h-13A2.5 2.5 0 0 1 3 17.5v-11A2.5 2.5 0 0 1 5.5 4H12" stroke="#fff" stroke-width="1.6" stroke-linecap="round"/><path d="M10 12h6M10 16h6" stroke="#fff" stroke-width="1.6" stroke-linecap="round"/><circle cx="18.5" cy="5.5" r="3.5" fill="#fff"/></svg>
            Book Appointment
          </a>
          <button class="btn btn-outline" id="callNow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4.5 5.5c0 8.284 6.716 15 15 15v-3a2 2 0 0 0-1.85-1.995l-3.67-.245a2 2 0 0 0-1.38.4l-1.24.93a16 16 0 0 1-6.75-6.75l.93-1.24a2 2 0 0 0 .4-1.38l-.25-3.67A2 2 0 0 0 7.5 3h-3A2 2 0 0 0 2.5 5v.5" stroke="#0b1720" stroke-width="1.6" stroke-linecap="round"/></svg>
            Call
          </button>
        </div>
        <div class="tel">+91 9641568109</div>
        <div style="margin-top:8px" class="note">Action buttons below are editable by Admin (name, icon URL, and target link).</div>
        <div id="actionButtons" class="actions" style="margin-top:10px">
          <!-- Admin-defined quick action buttons (icon+label) get injected here -->
        </div>
      </div>
    </div>
  </section>

  <!-- DOCTORS -->
  <h2 id="doctors" class="section-title">Our Expert Team</h2>
  <section class="h-scroll" id="doctorsRail" aria-label="Doctors">
    <!-- Sample placeholders (replaced by Firebase content if present) -->
    <article class="card doc-card">
      <div class="doc-photo">Photo</div>
      <div class="doc-body">
        <div style="display:flex;align-items:center;gap:8px">
          <strong>Arpan Das</strong><span class="pill">BPT</span><span class="fee">₹400</span>
        </div>
        <div class="doc-meta">
          <span>Experience: 5+ yrs</span>
        </div>
        <div class="doc-actions">
          <a class="btn btn-primary" href="https://wa.me/919641568109?text=Hello,%20I%20would%20like%20to%20book%20an%20appointment%20with%20Arpan%20Das." target="_blank">WhatsApp</a>
          <a class="btn btn-outline" href="tel:+919641568109">Call</a>
        </div>
      </div>
    </article>
    <article class="card doc-card">
      <div class="doc-photo">Photo</div>
      <div class="doc-body">
        <div style="display:flex;align-items:center;gap:8px">
          <strong>Jhunu Das</strong><span class="pill">DPT</span><span class="fee">₹400</span>
        </div>
        <div class="doc-meta">
          <span>Pediatric & Neuro</span>
        </div>
        <div class="doc-actions">
          <a class="btn btn-primary" href="https://wa.me/919641568109?text=Hello,%20I%20would%20like%20to%20book%20an%20appointment%20with%20Jhunu%20Das." target="_blank">WhatsApp</a>
          <a class="btn btn-outline" href="tel:+919641568109">Call</a>
        </div>
      </div>
    </article>
    <article class="card doc-card">
      <div class="doc-photo">Photo</div>
      <div class="doc-body">
        <div style="display:flex;align-items:center;gap:8px">
          <strong>Apurba Das</strong><span class="pill">DPT</span><span class="fee">₹400</span>
        </div>
        <div class="doc-meta">
          <span>Home Care Available</span>
        </div>
        <div class="doc-actions">
          <a class="btn btn-primary" href="https://wa.me/919641568109?text=Hello,%20I%20would%20like%20to%20book%20an%20appointment%20with%20Apurba%20Das." target="_blank">WhatsApp</a>
          <a class="btn btn-outline" href="tel:+919641568109">Call</a>
        </div>
      </div>
    </article>
  </section>

  <!-- SERVICES -->
  <h2 id="services" class="section-title">Our Services</h2>
  <div class="service-banner" id="serviceBanner">3:2 Banner (Admin editable)</div>

  <section class="services-rail" id="servicesGrid">
    <!-- Example card 1 -->
    <article class="card service-card">
      <div class="service-img" style="background-image:url('');"></div>
      <div class="service-body">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <strong>Physical Therapy</strong>
          <span class="badge">from ₹400</span>
        </div>
        <div class="muted" style="margin:6px 0 8px">Click to view tests/list</div>
        <div class="service-list">
          <div class="test-item"><span>Consultation</span><span>₹400</span></div>
          <div class="test-item"><span>Session (45min)</span><span>₹600</span></div>
        </div>
        <button class="btn btn-outline" onclick="toggleService(this)">View list</button>
      </div>
    </article>
    <!-- Example card 2 -->
    <article class="card service-card">
      <div class="service-img" style="background-image:url('');"></div>
      <div class="service-body">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <strong>Lab Tests</strong>
          <span class="badge">from ₹200</span>
        </div>
        <div class="muted" style="margin:6px 0 8px">CBC, LFT, RFT, Lipid, more</div>
        <div class="service-list">
          <div class="test-item"><span>CBC</span><span>₹300</span></div>
          <div class="test-item"><span>LFT</span><span>₹500</span></div>
          <div class="test-item"><span>RFT</span><span>₹450</span></div>
          <div class="test-item"><span>Lipid Profile</span><span>₹600</span></div>
        </div>
        <button class="btn btn-outline" onclick="toggleService(this)">View list</button>
      </div>
    </article>
  </section>

  <!-- PRODUCTS -->
  <h2 id="products" class="section-title">Our Products</h2>
  <section id="productsList" style="display:grid;grid-template-columns:1fr;gap:12px">
    <!-- Sample product 1 -->
    <article class="card product-card">
      <div class="product-img" style="background-image:url('');"></div>
      <div class="product-body">
        <strong>Lumbar Support Belt</strong>
        <div class="muted" style="margin:6px 0 10px">Medical grade lumbar support for back pain relief</div>
        <div class="price">₹1,200</div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <a class="btn btn-whatsapp" target="_blank" href="https://wa.me/919641568109?text=I%20would%20like%20to%20buy%20Lumbar%20Support%20Belt.">Buy Now on WhatsApp</a>
        </div>
      </div>
    </article>
    <!-- Sample product 2 -->
    <article class="card product-card">
      <div class="product-img" style="background-image:url('');"></div>
      <div class="product-body">
        <strong>Knee Support Brace</strong>
        <div class="muted" style="margin:6px 0 10px">Adjustable knee brace for injury support and prevention</div>
        <div class="price">₹800</div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <a class="btn btn-whatsapp" target="_blank" href="https://wa.me/919641568109?text=I%20would%20like%20to%20buy%20Knee%20Support%20Brace.">Buy Now on WhatsApp</a>
        </div>
      </div>
    </article>
  </section>

  <!-- MAP -->
  <h2 class="section-title">Find Us</h2>
  <div id="mapEmbed" class="card" style="overflow:hidden;border-radius:16px">
    <!-- Admin can set mapEmbedUrl in Firebase to override -->
    <iframe id="mapFrame" title="Clinic Map" src="https://www.google.com/maps?q=Kolkata&output=embed" width="100%" height="260" style="border:0" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
  </div>

  <!-- Footer -->
  <footer style="text-align:center;color:var(--muted);padding:20px 6px">
    © <span id="year"></span> Physio - The Therapeutic Moves · All rights reserved.
  </footer>
</main>

<!-- Floating quick actions -->
<div class="fab-stack">
  <a class="fab whatsapp" title="WhatsApp" target="_blank" aria-label="WhatsApp" id="fabWhatsApp">WA</a>
  <a class="fab call" title="Call" href="tel:+919641568109" aria-label="Call">📞</a>
  <a class="fab map" title="Map" href="#map" aria-label="Map">📍</a>
</div>

<!-- Admin Login Modal -->
<div id="adminModal" class="modal" aria-hidden="true">
  <div class="dialog">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
      <h3>Admin Login</h3>
      <button class="btn btn-outline" onclick="toggleModal(false)" style="padding:6px 10px;border-radius:8px">×</button>
    </div>
    <input id="email" class="input" type="email" placeholder="Email" autocomplete="username" />
    <div style="height:8px"></div>
    <input id="password" class="input" type="password" placeholder="Password" autocomplete="current-password" />
    <div class="admin-actions">
      <button id="loginBtn" class="btn btn-primary" style="width:100%">Login</button>
      <button id="logoutBtn" class="btn btn-outline" style="display:none;width:100%">Logout</button>
    </div>
    <div class="note" style="margin-top:10px">
      After login, inline edit tools appear on each section to update: logo, hero slides, action buttons, doctors, services, products, and map link. Data is saved to Firebase Realtime Database under paths shown in comments.
    </div>
  </div>
</div>

<!-- Inline admin edit toolbars (appear only when logged in) -->
<div id="editTools" style="display:none">
  <!-- Simple floating toolbar -->
  <div id="toolbar" class="card" style="position:fixed;left:50%;transform:translateX(-50%);bottom:80px;z-index:80;padding:8px 10px;display:flex;gap:8px;align-items:center">
    <button class="btn btn-outline" onclick="openEditor('brand')">Edit Logo/Brand</button>
    <button class="btn btn-outline" onclick="openEditor('hero')">Edit Hero</button>
    <button class="btn btn-outline" onclick="openEditor('actions')">Edit Actions</button>
    <button class="btn btn-outline" onclick="openEditor('doctors')">Edit Doctors</button>
    <button class="btn btn-outline" onclick="openEditor('services')">Edit Services</button>
    <button class="btn btn-outline" onclick="openEditor('products')">Edit Products</button>
    <button class="btn btn-outline" onclick="openEditor('map')">Edit Map</button>
  </div>
</div>

<!-- Lightweight Editors (prompt-based) -->
<div id="editorModal" class="modal" aria-hidden="true">
  <div class="dialog">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
      <h3 id="editorTitle">Editor</h3>
      <button class="btn btn-outline" onclick="toggleEditor(false)" style="padding:6px 10px;border-radius:8px">×</button>
    </div>
    <textarea id="editorJson" class="input" style="height:220px;font-family:ui-monospace,Menlo,Consolas,monospace" placeholder='Enter JSON data...'></textarea>
    <div class="note" style="margin:8px 0">
      Paste JSON and Save. Examples are prefilled for each section. Images accept direct URLs (e.g., imgbb). All numbers should be plain numbers (no commas) where possible.
    </div>
    <div class="row">
      <button class="btn btn-primary" style="flex:1" onclick="saveEditor()">Save</button>
      <button class="btn btn-outline" style="flex:1" onclick="loadSection(activeEditorKey,true)">Reload</button>
    </div>
  </div>
</div>

<!-- SCRIPTS -->
<script type="module">
  // Firebase v10+ modular SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getDatabase, ref, onValue, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // Your Firebase config (provided)
  const firebaseConfig = {
    apiKey: "AIzaSyAuk3feAZjoHF2VwdWtA0F4lhQKarU0w-4",
    authDomain: "clinic-bdf92.firebaseapp.com",
    databaseURL: "https://clinic-bdf92-default-rtdb.firebaseio.com",
    projectId: "clinic-bdf92",
    storageBucket: "clinic-bdf92.firebasestorage.app",
    messagingSenderId: "302452317883",
    appId: "1:302452317883:web:6585bf22ea1a7f3a96939e",
    measurementId: "G-XZXEVNMVRS"
  };
  const app = initializeApp(firebaseConfig);
  getAnalytics(app);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // Helpers
  const $ = sel => document.querySelector(sel);
  const $$ = sel => document.querySelectorAll(sel);

  // Menu
  const drawer = $('#drawer');
  $('#openMenu').onclick = () => drawer.classList.add('open');
  $('#closeMenu').onclick = () => drawer.classList.remove('open');

  // Footer year
  $('#year').textContent = new Date().getFullYear();

  // WhatsApp links
  const clinicWA = "919641568109";
  const bookMsg = encodeURIComponent("Hello, I would like to book an appointment with Physio - The Therapeutic Moves.");
  $('#bookWhatsApp').href = `https://wa.me/${clinicWA}?text=${bookMsg}`;
  $('#fabWhatsApp').href = `https://wa.me/${clinicWA}?text=${bookMsg}`;
  $('#callNow').onclick = () => location.href = 'tel:+919641568109';

  // Hero slideshow autoplay
  let slideIdx = 0;
  setInterval(() => {
    const slides = [...document.querySelectorAll('.slide')];
    slides.forEach(s=>s.classList.remove('active'));
    slideIdx = (slideIdx + 1) % slides.length;
    slides[slideIdx].classList.add('active');
  }, 3500);

  // Services toggle
  window.toggleService = (btn) => {
    const card = btn.closest('.service-card');
    card.classList.toggle('open');
    btn.textContent = card.classList.contains('open') ? 'Hide list' : 'View list';
  };

  // Admin modal
  const adminModal = $('#adminModal');
  function toggleModal(show){ adminModal.classList.toggle('open', !!show); }
  $('#adminLoginLink').onclick = (e)=>{ e.preventDefault(); toggleModal(true); drawer.classList.remove('open'); };
  window.toggleModal = toggleModal;

  // Auth actions
  $('#loginBtn').onclick = async ()=>{
    const email = $('#email').value.trim();
    const pass = $('#password').value;
    try{
      await signInWithEmailAndPassword(auth, email, pass);
      toggleModal(false);
    }catch(err){ alert(err.message); }
  };
  $('#logoutBtn').onclick = async ()=>{ await signOut(auth); };

  // State UI
  const editTools = $('#editTools');
  onAuthStateChanged(auth, (user)=>{
    const loggedIn = !!user;
    $('#loginBtn').style.display = loggedIn ? 'none' : 'inline-flex';
    $('#logoutBtn').style.display = loggedIn ? 'inline-flex' : 'none';
    editTools.style.display = loggedIn ? 'block' : 'none';
  });

  // Data paths and loaders
  // Realtime Database structure (all optional):
  // clinic/brand: { name, tagline, logoUrl }
  // clinic/heroSlides: [ { imageUrl }, ... ]
  // clinic/actions: [ { label, iconUrl, href }, ... ]
  // clinic/doctors: [ { name, qualification, fee, photoUrl, details }, ... ]
  // clinic/services: [ { title, coverUrl, note, fromPrice, items:[{name,price}], }, ... ]
  // clinic/products: [ { name, imageUrl, description, price, buyMessage }, ... ]
  // clinic/mapEmbedUrl: "https://..."
  async function loadSection(key, silent=false){
    try{
      const snap = await get(child(ref(db), `clinic/${key}`));
      const data = snap.exists() ? snap.val() : null;
      if(!silent) console.log(`Loaded ${key}`, data);
      if(!data) return;

      if(key==='brand'){
        if(data.logoUrl){ $('#logo').style.backgroundImage = `url(${data.logoUrl})`; $('#logo').style.backgroundSize='cover'; $('#logo').textContent=''; }
        if(data.name) document.querySelector('.brand .name').textContent = data.name;
        if(data.tagline) document.querySelector('.brand .tag').textContent = data.tagline;
      }
      if(key==='heroSlides'){
        const box = $('#heroSlides'); box.innerHTML='';
        (Array.isArray(data)?data:[]).forEach((s,i)=>{
          const d = document.createElement('div');
          d.className = 'slide'+(i===0?' active':'');
          d.style.backgroundImage = s?.imageUrl ? `url('${s.imageUrl}')` : 'linear-gradient(135deg,#bfe9db,#eafbf6)';
          box.appendChild(d);
        });
      }
      if(key==='actions'){
        const wrap = $('#actionButtons'); wrap.innerHTML='';
        (Array.isArray(data)?data:[]).forEach(a=>{
          const btn = document.createElement('a');
          btn.className='action-btn'; btn.target='_blank'; btn.href = a.href||'#';
          if(a.iconUrl){ const ic = document.createElement('img'); ic.src=a.iconUrl; btn.appendChild(ic); }
          const t = document.createElement('span'); t.textContent = a.label||'Action'; btn.appendChild(t);
          wrap.appendChild(btn);
        });
      }
      if(key==='doctors'){
        const rail = $('#doctorsRail'); rail.innerHTML='';
        (Array.isArray(data)?data:[]).forEach(doc=>{
          const card = document.createElement('article'); card.className='card doc-card';
          const photo = document.createElement('div'); photo.className='doc-photo';
          if(doc.photoUrl){ photo.style.backgroundImage=`url('${doc.photoUrl}')`; photo.style.backgroundSize='cover'; photo.style.backgroundPosition='center'; photo.textContent=''; }
          else { photo.textContent='Photo'; }
          const body = document.createElement('div'); body.className='doc-body';
          body.innerHTML = `
            <div style="display:flex;align-items:center;gap:8px">
              <strong>${doc.name||''}</strong>
              ${doc.qualification?`<span class="pill">${doc.qualification}</span>`:''}
              ${doc.fee?`<span class="fee">₹${doc.fee}</span>`:''}
            </div>
            <div class="doc-meta">${doc.details?`<span>${doc.details}</span>`:''}</div>
          `;
          const actions = document.createElement('div'); actions.className='doc-actions';
          const waMsg = encodeURIComponent(`Hello, I would like to book an appointment with ${doc.name||'the doctor'}.`);
          const wa = document.createElement('a'); wa.className='btn btn-primary'; wa.target='_blank'; wa.href=`https://wa.me/${clinicWA}?text=${waMsg}`; wa.textContent='WhatsApp';
          const call = document.createElement('a'); call.className='btn btn-outline'; call.href='tel:+919641568109'; call.textContent='Call';
          actions.append(wa, call); body.appendChild(actions);
          card.append(photo, body); rail.appendChild(card);
        });
      }
      if(key==='services'){
        const grid = $('#servicesGrid'); grid.innerHTML='';
        (Array.isArray(data)?data:[]).forEach(svc=>{
          const card = document.createElement('article'); card.className='card service-card';
          const img = document.createElement('div'); img.className='service-img';
          if(svc.coverUrl) img.style.backgroundImage = `url('${svc.coverUrl}')`;
          const body = document.createElement('div'); body.className='service-body';
          const list = document.createElement('div'); list.className='service-list';
          (svc.items||[]).forEach(it=>{
            const row = document.createElement('div'); row.className='test-item';
            row.innerHTML = `<span>${it.name||''}</span><span>${it.price?`₹${it.price}`:''}</span>`;
            list.appendChild(row);
          });
          body.innerHTML = `
            <div style="display:flex;align-items:center;justify-content:space-between">
              <strong>${svc.title||'Service'}</strong>
              ${svc.fromPrice?`<span class="badge">from ₹${svc.fromPrice}</span>`:''}
            </div>
            <div class="muted" style="margin:6px 0 8px">${svc.note||'Click to view list'}</div>
          `;
          const btn = document.createElement('button'); btn.className='btn btn-outline'; btn.textContent='View list'; btn.onclick=()=>toggleService(btn);
          body.append(list, btn);
          card.append(img, body); grid.appendChild(card);
        });
      }
      if(key==='products'){
        const list = $('#productsList'); list.innerHTML='';
        (Array.isArray(data)?data:[]).forEach(p=>{
          const card = document.createElement('article'); card.className='card product-card';
          const img = document.createElement('div'); img.className='product-img';
          if(p.imageUrl) img.style.backgroundImage = `url('${p.imageUrl}')`;
          const body = document.createElement('div'); body.className='product-body';
          const msg = encodeURIComponent(p.buyMessage || `I would like to buy ${p.name||'the product'}.`);
          body.innerHTML = `
            <strong>${p.name||'Product'}</strong>
            <div class="muted" style="margin:6px 0 10px">${p.description||''}</div>
            ${p.price?`<div class="price">₹${Number(p.price).toLocaleString('en-IN')}</div>`:''}
            <div style="margin-top:10px;display:flex;gap:8px">
              <a class="btn btn-whatsapp" target="_blank" href="https://wa.me/${clinicWA}?text=${msg}">Buy Now on WhatsApp</a>
            </div>
          `;
          card.append(img, body); list.appendChild(card);
        });
      }
      if(key==='map'){
        if(typeof data==='string'){ $('#mapFrame').src = data; }
        if(data?.mapEmbedUrl){ $('#mapFrame').src = data.mapEmbedUrl; }
      }
      if(key==='serviceBanner'){
        const el = $('#serviceBanner');
        if(typeof data==='string'){ el.style.backgroundImage = `url('${data}')`; el.textContent=''; }
        if(data?.imageUrl){ el.style.backgroundImage = `url('${data.imageUrl}')`; el.textContent=''; }
      }
    }catch(e){ console.warn('Load error', key, e); }
  }

  // Initial loads
  ['brand','heroSlides','actions','doctors','services','products','map','serviceBanner'].forEach(k=>loadSection(k,true));

  // Simple JSON editors
  let activeEditorKey = null;
  const editorModal = $('#editorModal');
  function toggleEditor(show){ editorModal.classList.toggle('open', !!show); }
  window.toggleEditor = toggleEditor;

  function exampleJson(key){
    const ex = {
      brand: {
        name:"Physio - The Therapeutic Moves",
        tagline:"We add life in your days.",
        logoUrl:"https://i.ibb.co/3WZQmL6/placeholder-logo.png"
      },
      hero: [
        {"imageUrl":"https://i.ibb.co/2k4dZ8C/hero1.jpg"},
        {"imageUrl":"https://i.ibb.co/NjJqC6V/hero2.jpg"}
      ],
      actions: [
        {"label":"WhatsApp","iconUrl":"https://i.ibb.co/18w8R3p/whatsapp.png","href":"https://wa.me/919641568109"},
        {"label":"Website","iconUrl":"https://i.ibb.co/6wm0Q9k/link.png","href":"https://example.com"}
      ],
      doctors: [
        {"name":"Arpan Das","qualification":"BPT","fee":400,"photoUrl":"","details":"Orthopedic & Sports Rehab"},
        {"name":"Jhunu Das","qualification":"DPT","fee":400,"photoUrl":"","details":"Pediatric & Neuro"},
        {"name":"Apurba Das","qualification":"DPT","fee":400,"photoUrl":"","details":"Home Care Available"}
      ],
      services: [
        {"title":"Physical Therapy","coverUrl":"","note":"Click to view sessions","fromPrice":400,"items":[{"name":"Consultation","price":400},{"name":"Session (45min)","price":600}]},
        {"title":"Lab Tests","coverUrl":"","note":"Popular blood tests","fromPrice":200,"items":[{"name":"CBC","price":300},{"name":"LFT","price":500},{"name":"RFT","price":450},{"name":"Lipid Profile","price":600}]}
      ],
      products: [
        {"name":"Lumbar Support Belt","imageUrl":"","description":"Medical grade lumbar support for back pain relief","price":1200,"buyMessage":"I would like to buy Lumbar Support Belt."},
        {"name":"Knee Support Brace","imageUrl":"","description":"Adjustable knee brace for injury support and prevention","price":800,"buyMessage":"I would like to buy Knee Support Brace."}
      ],
      map: {"mapEmbedUrl":"https://www.google.com/maps?q=Kolkata&output=embed"},
      serviceBanner: {"imageUrl":"https://i.ibb.co/02LxgqH/service-banner.jpg"}
    };
    switch(key){
      case 'brand': return ex.brand;
      case 'hero': return ex.hero;
      case 'actions': return ex.actions;
      case 'doctors': return ex.doctors;
      case 'services': return ex.services;
      case 'products': return ex.products;
      case 'map': return ex.map;
      case 'serviceBanner': return ex.serviceBanner;
      default: return {};
    }
  }

  function openEditor(key){
    activeEditorKey = key;
    $('#editorTitle').textContent = `Edit ${key[0].toUpperCase()}${key.slice(1)}`;
    let preset = exampleJson(key==='hero'?'hero':key);
    $('#editorJson').value = JSON.stringify(preset, null, 2);
    toggleEditor(true);
  }
  window.openEditor = openEditor;

  async function saveEditor(){
    if(!activeEditorKey) return;
    let val;
    try{
      val = JSON.parse($('#editorJson').value);
    }catch(e){
      alert('Invalid JSON'); return;
    }
    let path = 'clinic/';
    // Map editor keys to DB keys
    const map = {
      brand:'brand',
      hero:'heroSlides',
      actions:'actions',
      doctors:'doctors',
      services:'services',
      products:'products',
      map:'map',
      serviceBanner:'serviceBanner'
    };
    path += map[activeEditorKey] || activeEditorKey;
    try{
      await set(ref(db, path), val);
      alert('Saved!');
      toggleEditor(false);
      // reload UI
      const reloadKey = map[activeEditorKey] || activeEditorKey;
      loadSection(reloadKey,true);
    }catch(e){
      alert('Save failed: '+e.message);
    }
  }
  window.saveEditor = saveEditor;

  // Accessibility for closing modals via backdrop click
  [adminModal, editorModal].forEach(m=>{
    m.addEventListener('click', (e)=>{ if(e.target===m){ m.classList.remove('open'); } });
  });

</script>

<!-- Non-module fallback: no JS needed beyond -->
<noscript>
  This site requires JavaScript to load dynamic content and admin editing. Please enable JavaScript.
</noscript>
</body>
</html>
